###
### Step 2.0: HLT integration tests ### 
###

hltIntegrationTests /users/mzarucki/SoftTriggers/SoftTriggers/V15 \
-i root://cms-xrd-global.cern.ch//store/mc/RunIISummer17DRStdmix/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/GEN-SIM-RAW/NZSFlatPU28to62_92X_upgrade2017_realistic_v10-v2/50000/8CAC0136-BFA0-E711-82A8-0025904B2C4C.root  \
-s /dev/CMSSW_9_2_0/GRun/V145 \
-x "--globaltag 92X_upgrade2017_realistic_v12" \
-x "--offline --unprescale" \
-j 8 \
> hltIntegrationTestResults.txt


###
### Step 2.1: HLT configuration with customised menu: ###
###

hltGetConfiguration /users/mzarucki/SoftTriggers/SoftTriggers/V15 \
--setup /dev/CMSSW_9_2_0/GRun/V145 \
--globaltag 92X_upgrade2017_realistic_v12 \
--mc --offline --unprescale --cff \
> HLT_SoftTriggers_92X_cff.py

Additional option to use only subset of menu:
--paths HLTriggerFirstPath,HLTriggerFinalPath,HLT_*

In the cfg fix the setup fragment path: fragment.load("HLTrigger.Configuration.setup_dev_CMSSW_9_2_0_GRun_V145_cff")

Copy the cfg and the setup cffs to the python dir: $CMSSW_BASE/src/HLTrigger/Configuration/python


###
### Step 2.2: Configuration for RAW + HLT steps with customised menu ###
###

cmsDriver.py SoftTriggers \
--filein root://hephyse.oeaw.ac.at//store/user/mzarucki/T2tt_dM-10to80_mStop-500_mLSP-460_privGridpack_GEN-SIM/T2tt_dM-10to80_mStop-500_mLSP-460_privGridpack_GEN-SIM/180122_170545/0000/T2tt_dM-10to80_mStop-500_mLSP-460_privGridpack_GEN-SIM_1.root \
--fileout file:T2tt_dM-10to80_mStop-500_mLSP-460_HLT_SoftTriggers-V15.root \
--step=DIGI,L1,DIGI2RAW,HLT:SoftTriggers_92X --processName=SoftTriggers --datatier GEN-SIM-RAW --eventcontent RAWSIM \
--conditions 92X_upgrade2017_realistic_v12 --era Run2_2017 --geometry DB:Extended --beamspot Realistic25ns13TeVEarly2017Collision --mc \
--nThreads 4 \
-n 100 \
--no_exec

(produces SoftTriggers_DIGI_L1_DIGI2RAW_HLT.py)


###
### Step 2.2: HLT Only (over central RAW samples)
###

cmsDriver.py SoftTriggers \
--filein file:file.root \ 
--fileout file:WJetsToLNu_HLT_SoftTriggers-V15.root \
--step=HLT:SoftTriggers_92X --processName=SoftTriggers --datatier GEN-SIM-RAW --eventcontent RAWSIM \
--conditions 92X_upgrade2017_realistic_v12 --era Run2_2017 --geometry DB:Extended --beamspot Realistic25ns13TeVEarly2017Collision --mc \
--nThreads 4 \
-n 100 \
--no_exec

(produces SoftTriggers_HLT.py)

NOTE: DIGI,L1,DIGI2RAW steps required if one is to re-run L1 (with eg. customised L1 menu)

NOTE: To add pileup profile, this option should be added (works with RAW step, as in: https://twiki.cern.ch/twiki/bin/viewauth/CMS/TSGPhaseIFall16DR92x):
--pileup 2016_25ns_Moriond17MC_PoissonOOTPU --pileup_input "dbs:/MinBias_TuneCUETP8M1_13TeV-pythia8/RunIISummer17GS-92X_upgrade2017_realistic_v2-v1/GEN-SIM" --customise_commands "process.mix.input.nbPileu
s.vint32(0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62) \n process.mix.


###
### Step 3: Configuration for AODSIM step over output of HLT step ###
###

cmsDriver.py SoftTriggers \
--filein root://hephyse.oeaw.ac.at//store/user/mzarucki/T2tt_dM-10to80_mStop-500_mLSP-460_privGridpack_GEN-SIM/T2tt_dM-10to80_mStop-500_mLSP-460_HLT_SoftTriggers-V15/180124_005336/0000/T2tt_dM-10to80_mStop-500_mLSP-460_HLT_SoftTriggers-V15_1.root \
--fileout file:T2tt_dM-10to80_mStop-500_mLSP-460_SoftTriggers-V15_AODSIM.root \
--step RAW2DIGI,L1Reco,RECO --datatier AODSIM --eventcontent AODSIM \
--conditions 92X_upgrade2017_realistic_v12 --era Run2_2017 --geometry DB:Extended --beamspot Realistic25ns13TeVEarly2017Collision --mc \
--nThreads 4 \
-n 100 \
--no_exec

(produces SoftTriggers_RAW2DIGI_L1Reco_RECO.py)

NOTE: difference AODSIM vs RECOSIM?

###
Optional: Add TriggerDecisionAnalyzer EDProducer to extract custom trigger decision from trigger results #NOTE: can be done in HLT step or in AODSIM step
###

## RAW ##

#NOTE: only needed if one wants the triggers as separate branches

# Output definition
process.RAWSIMEventContent.outputCommands.append('keep bool_*_HLT*_*')

# Additional output definition
process.trigDec = cms.EDProducer('TriggerDecisionAnalyzer')
process.trigDec_step = cms.EndPath(process.trigDec)

# Schedule definition
process.schedule.extend([process.endjob_step, process.trigDec_step, process.RAWSIMoutput_step])

## AOD ##
Add:
# Output definition
process.AODSIMEventContent.outputCommands.append('keep bool_*_HLT*_*')
